import streamlit as st
import numpy as np

# 1. ç¶²é é…ç½®
st.set_page_config(page_title="UIAå¥½åé‚Š-é•·ç…§è£œåŠ©è³‡æ ¼å°å¹«æ‰‹", page_icon="ğŸ¡")

# 2. æº«é¦¨é–‹å ´ç™½
st.title("é•·ç…§è£œåŠ©è³‡æ ¼å°å¹«æ‰‹")
st.markdown("""
### **ç…§é¡§è·¯ä¸Šï¼Œæ‚¨è¾›è‹¦äº†ï¼** ä¸çŸ¥é“ç¾åœ¨çš„ç‹€æ³èƒ½ä¸èƒ½ç”³è«‹æ”¿åºœè£œåŠ©å—ï¼Ÿ
è·Ÿè‘—å¥½åé‚Šå›ç­”å¹¾å€‹ç°¡å–®çš„å•é¡Œï¼Œæˆ‘å€‘å¹«æ‚¨å°ç…§ **é•·ç…§ 3.0** çš„æœ€æ–°æ¨™æº–ã€‚
""")

st.divider()

# 3. ç¬¬ä¸€æ­¥ï¼šåŸºæœ¬èº«åˆ† 
st.subheader("ğŸ“Œ 1. èŠèŠè¦ªå±¬ç‹€æ³")
age = st.slider("è¦ªå±¬ä»Šå¹´å¹¾æ­²äº†å‘¢ï¼Ÿ", 0, 100, 65)

# å°‡æ‰€æœ‰å‹¾é¸é …ç›®å‚ç›´æ’åˆ—åœ¨å·¦å´
is_aboriginal = st.checkbox("å…·æœ‰åŸä½æ°‘èº«åˆ† (55 æ­²ä»¥ä¸Šå³å¯ç”³è«‹)")
has_disability_card = st.checkbox("é ˜æœ‰èº«å¿ƒéšœç¤™è­‰æ˜")
is_pac = st.checkbox("æ€¥æ€§å¾ŒæœŸæ•´åˆç…§è­·è¨ˆç•«æ”¶æ¡ˆå°è±¡")
is_rich = st.checkbox("å»å¹´æ‰€å¾—ç¨…ç‡é” 20% ä»¥ä¸Š (æˆ–æ‰€å¾—æ·¨é¡è¶…é 126 è¬)")

# 4. ç¬¬äºŒæ­¥ï¼šå¤±èƒ½ç‹€æ³è©•ä¼°
st.subheader("ğŸ“Œ 2. å¹³æ™‚æ—¥å¸¸æ´»å‹•")
dementia = st.radio("è¦ªå±¬æ˜¯å¦æœ‰å¤±æ™ºç—‡ç‹€ï¼Ÿ (å¦‚ï¼šå¸¸å¿˜è¨˜å›å®¶çš„è·¯ã€èªä¸å¾—äºº)", ["æ²’æœ‰", "æœ‰ï¼Œå·²ç¢ºè¨ºæˆ–ç–‘ä¼¼"], horizontal=True)

mobility_desc = st.select_slider(
    "ç›®å‰å®¶äººçš„èµ°å‹•ç‹€æ³æ˜¯ï¼Ÿ",
    options=["å¥æ­¥å¦‚é£›", "éœ€è¦äººå®¶æ‰¶ä¸€ä¸‹", "è¦åè¼ªæ¤…æ‰èƒ½ç§»å‹•", "å¤§éƒ¨åˆ†æ™‚é–“éƒ½èººåœ¨åºŠä¸Š"]
)
mobility_map = {"å¥æ­¥å¦‚é£›": "å®Œå…¨è‡ªç†", "éœ€è¦äººå®¶æ‰¶ä¸€ä¸‹": "éœ€éƒ¨åˆ†æ‰¶æŒ", "è¦åè¼ªæ¤…æ‰èƒ½ç§»å‹•": "éœ€ä»–äººæ¨è¼ªæ¤…", "å¤§éƒ¨åˆ†æ™‚é–“éƒ½èººåœ¨åºŠä¸Š": "å®Œå…¨è‡¥åºŠ"}
mobility = mobility_map[mobility_desc]

# 5. é‚è¼¯å›æ­¸é‹ç®—
def calculate_prob_3_0(age, is_ab, has_card, is_pac, is_dem, mob_score, is_rich):
    if is_rich: return 0.05 
    z = -4.5 
    if (age >= 65) or (is_ab and age >= 55) or (is_dem == "æœ‰ï¼Œå·²ç¢ºè¨ºæˆ–ç–‘ä¼¼" and age >= 50):
        z += 2.0
    if has_card or is_pac:
        z += 3.0
    mob_weight = {"å®Œå…¨è‡ªç†": 0, "éœ€éƒ¨åˆ†æ‰¶æŒ": 1.5, "éœ€ä»–äººæ¨è¼ªæ¤…": 2.5, "å®Œå…¨è‡¥åºŠ": 4.0}
    z += mob_weight[mob_score]
    return 1 / (1 + np.exp(-z))

# 6. çµæœå‘ˆç¾
st.divider()
if st.button("âœ¨ é»æˆ‘é–‹å§‹è©•ä¼°"):
    with st.spinner('å¥½åé‚Šåˆ†æä¸­...'):
        prob = calculate_prob_3_0(age, is_aboriginal, has_disability_card, is_pac, dementia, mobility, is_rich)
    
    st.markdown(f"### ğŸ¯ AI è©•ä¼°çµæœï¼šç¬¦åˆæ©Ÿç‡ç´„ <span style='color:#F39800;'>**{prob*100:.1f}%**</span>", unsafe_allow_html=True)
    
    
    
    if is_rich:
        st.error("âš ï¸ **å°æé†’ï¼š** ç™¼ç¾åˆ°å®¶äººç¬¦åˆã€Œæ’å¯Œæ—ç¾¤ã€æ¢ä»¶ï¼Œæ”¿åºœè£œåŠ©é¡åº¦å°‡å¤§å¹…å—é™ã€‚")
    elif prob >= 0.6:
        st.success("âœ… **å¾ˆæœ‰æ©Ÿæœƒå–”ï¼** å»ºè­°æ‚¨ç¾åœ¨å°±æ’¥æ‰“ **1966** å°ˆç·šé ç´„æ­£å¼è©•ä¼°ã€‚")
        st.balloons()
    elif prob >= 0.4:
        st.warning("ğŸŸ¡ **ç›®å‰åœ¨é–€æª»é‚Šç·£ï¼š** å»ºè­°è«®è©¢å°ˆæ¥­é†«è­·æˆ–äº†è§£ UIAå¥½åé‚Šçš„æœå‹™å» å•†è‡ªè²»æ–¹æ¡ˆã€‚")
    else:
        st.info("âšª **ç›®å‰ç‹€æ³é‚„ç®—å¥åº·ï¼š** é›–ç„¶é ˜åˆ°è£œåŠ©çš„æ©Ÿæœƒè¼ƒä½ï¼Œä½†é é˜²å‹æ–¼æ²»ç™‚ï¼")

st.markdown("---")
st.caption("ğŸ’Œ UIAå¥½åé‚Šé—œå¿ƒæ‚¨ã€‚æœ¬è©•ä¼°åƒ…ä¾›åƒè€ƒï¼Œæ­£å¼çµæœä»¥æ”¿åºœç…§ç®¡å°ˆå“¡è©•ä¼°ç‚ºæº–ã€‚")
